# 2018年12月26日

:::tip
讲一讲工作上遇到过的解码问题
:::

工作中遇到一个需求调研，要求往图片文件数据中插入一段 xml 数据，不改变图片显示情况，同时要求，当用户上传这张图片的时候，我们能够从中获取数据。<br>

首先讲讲，如何生成图片，这里使用的是一个叫 `canvg-browser` 的库。<br>

```ts

const getCanvasWhenRenderCompletely = async(canvas:HTMLCanvasElement) => {
  return new Promise((resolve:(res:HTMLCanvasElement) => any) => {
    canvg(canvas, xmlData)
  });
}

const generatePicture = async() => {
  const canvas = document.createElement('canvas');
  document.body.appendChild(canvas);
  const xmlData = `<svg viewBox="0 0 100 100" width="100" height="100">
    <image xlink:href="../assets/20-owl.png"
      width="100" height="100"/>
  </svg>`;
  const completelyRenderCanvas = await getCanvasWhenRenderCompletely(canvas);
}

```

![](../assets/07/20-owl.png)