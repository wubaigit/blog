<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GO 语言开发规范 | Owl</title>
    <meta name="description" content="">
    <link rel="icon" href="/wubai-blog/20-owl.png">
    
    <link rel="preload" href="/wubai-blog/assets/css/0.styles.08db41c5.css" as="style"><link rel="preload" href="/wubai-blog/assets/js/app.4c219921.js" as="script"><link rel="preload" href="/wubai-blog/assets/js/22.e7a0c376.js" as="script"><link rel="prefetch" href="/wubai-blog/assets/js/10.bef5c67e.js"><link rel="prefetch" href="/wubai-blog/assets/js/11.b72e42c8.js"><link rel="prefetch" href="/wubai-blog/assets/js/12.d1863744.js"><link rel="prefetch" href="/wubai-blog/assets/js/13.22858cd4.js"><link rel="prefetch" href="/wubai-blog/assets/js/14.fcd93087.js"><link rel="prefetch" href="/wubai-blog/assets/js/15.b92e4d21.js"><link rel="prefetch" href="/wubai-blog/assets/js/16.4ad9d868.js"><link rel="prefetch" href="/wubai-blog/assets/js/17.0bfe4e0d.js"><link rel="prefetch" href="/wubai-blog/assets/js/18.465be9ee.js"><link rel="prefetch" href="/wubai-blog/assets/js/19.aad1b8f4.js"><link rel="prefetch" href="/wubai-blog/assets/js/2.bbde44a5.js"><link rel="prefetch" href="/wubai-blog/assets/js/20.d1648ea2.js"><link rel="prefetch" href="/wubai-blog/assets/js/21.80222452.js"><link rel="prefetch" href="/wubai-blog/assets/js/23.8fb9f707.js"><link rel="prefetch" href="/wubai-blog/assets/js/24.42821c4f.js"><link rel="prefetch" href="/wubai-blog/assets/js/25.68a565f9.js"><link rel="prefetch" href="/wubai-blog/assets/js/26.40bf583d.js"><link rel="prefetch" href="/wubai-blog/assets/js/27.70e4d306.js"><link rel="prefetch" href="/wubai-blog/assets/js/28.3ffb6c54.js"><link rel="prefetch" href="/wubai-blog/assets/js/3.de795230.js"><link rel="prefetch" href="/wubai-blog/assets/js/4.c3c3f315.js"><link rel="prefetch" href="/wubai-blog/assets/js/5.8c824716.js"><link rel="prefetch" href="/wubai-blog/assets/js/6.3f219668.js"><link rel="prefetch" href="/wubai-blog/assets/js/7.cdce0d92.js"><link rel="prefetch" href="/wubai-blog/assets/js/8.aff989a9.js"><link rel="prefetch" href="/wubai-blog/assets/js/9.33cd7c9c.js">
    <link rel="stylesheet" href="/wubai-blog/assets/css/0.styles.08db41c5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wubai-blog/" class="home-link router-link-active"><!----> <span class="site-name">Owl</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>首页</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/wubai-blog/" class="sidebar-link">Hello World</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>杂谈</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JS 笔记</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="go-语言开发规范"><a href="#go-语言开发规范" aria-hidden="true" class="header-anchor">#</a> GO 语言开发规范</h1> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>来自编程猫<br></p></div> <h2 id="通用规范"><a href="#通用规范" aria-hidden="true" class="header-anchor">#</a> 通用规范</h2> <ul><li>方法名，变量名，类名等的命名，必须反映出相应的业务含义，需要见名知意。</li> <li>静态（变量/常量）必须大写，并且单词之间用下划线隔开。</li> <li>不允许使用魔法数字，需要定义常量（普通常量或枚举）。</li> <li>会经常改变的常量，需要写到配置文件（或DB）中，禁止直接在代码中进行硬编码。</li> <li>单个方法的代码不宜超过100行， 超过200行的必须重构。</li> <li>单个文件行数需要控制在1000行以下。</li> <li>while或if 等嵌套查询复杂度不容许超过3层。 if 条件能一次判断的，不要嵌套方式分多次判断。</li> <li>if-else if--else 语句超过8个的必须重构，可以采用策略模式、状态模式、map等方式实现。</li> <li>判断语句非常复杂的(不宜超过4个），必须抽取成方法，提高可读性。</li> <li>修改代码的时候，看一下该代码的注释是否也需要一起修改，必须保持代码和注释的一致性，不然注释不但无用，反而可能误导人。（修改时，注释需要加修改人，更新说明、更新时间）</li> <li>对于使用了特殊技巧的代码， 不是那么容易一眼看明白的，必须写明大体设计思路和代码技巧说明。</li> <li>对于从网上copy下来的代码，必须先读懂代码并测试验证其正确性， 然后对代码的实现，进行一定的重构，以满足我们的开发规范。 （因为网上的代码很多只是为了展示其解决方案而编写比较随意的代码，不是生产级别的代码，会存在很多问题)</li></ul> <h2 id="go-fmt"><a href="#go-fmt" aria-hidden="true" class="header-anchor">#</a> go fmt</h2> <p>大部分的格式问题可以通过 gofmt 解决，gofmt 自动格式化代码，保证所有的Go代码与官方推荐的格式保持一致，于是所有格式有关问题，都以 gofmt 的结果为准。
代码提交前，必须执行gofmt进行格式化。Vs code会在每次保存时执行一次格式化</p> <h2 id="go-vet"><a href="#go-vet" aria-hidden="true" class="header-anchor">#</a> go vet</h2> <p>vet工具可以帮我们静态分析我们的源码存在的各种问题，例如多余的代码，提前return的逻辑，struct的tag是否符合标准等。
代码提交前，必须执行go ver进行静态检查。</p> <h2 id="长度约定"><a href="#长度约定" aria-hidden="true" class="header-anchor">#</a> 长度约定</h2> <ul><li>代码块长度，比如约定超过50行就需要考虑优化。</li> <li>行代码长度控制，太长的需换行，提高代码可读性。</li></ul> <h2 id="注释"><a href="#注释" aria-hidden="true" class="header-anchor">#</a> 注释</h2> <ul><li>对外（Public）的结构体、函数和包必须进行注释</li> <li>结构体注释格式：</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// ObjectMeta is metadata that all persisted resources must have, which includes all objects</span>
<span class="token comment">// users must create.</span>
<span class="token keyword">type</span> ObjectMeta <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>函数注释格式：</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// Compile parses a regular expression and returns, if successful,</span>
<span class="token comment">// a Regexp that can be used to match against text.</span>
<span class="token keyword">func</span> <span class="token function">Compile</span><span class="token punctuation">(</span>str <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Regexp<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>包注释格式：</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// Package path implements utility routines for</span>
<span class="token comment">// manipulating slash-separated filename paths.</span>
path
</code></pre></div><h2 id="消息命名"><a href="#消息命名" aria-hidden="true" class="header-anchor">#</a> 消息命名</h2> <ul><li>前端发送给后端的消息以 C2S_ 开头（？）</li> <li>后端发送给前端的消息以 S2C_ 开头（？）</li></ul> <h2 id="命名"><a href="#命名" aria-hidden="true" class="header-anchor">#</a> 命名</h2> <ul><li>关键或者复杂的代码需要进行注释</li> <li>注释内容必须是可读的完整句子，简要并且突出重点。</li> <li>需要注释来补充的命名就不算是好命名。</li> <li>使用可搜索的名称：单字母名称和数字常量很难从一大堆文字中搜索出来。单字母名称仅适用于短方法中的本地变量，名称长短应与其作用域相对应。若变量或常量可能在代码中多处使用，则应赋其以便于搜索的名称。</li> <li>做有意义的区分：Product 和 ProductInfo 和 ProductData 没有区别，NameString 和 Name 没有区别，要区分名称，就要以读者能鉴别不同之处的方式来区分 。</li> <li>函数命名规则：驼峰式命名，名字可以长但是得把功能，必要的参数描述清楚，函数名名应当是动词或动词短语，不可导出的函数以小写开头。</li></ul> <p>如 postPayment、deletePage、save。并依 Javabean 标准加上 get、set、is 前缀。例如：xxx + With + 需要的参数名 + And + 需要的参数名 + …..</p> <ul><li>结构体命名规则：结构体名应该是名词或名词短语，如 Custome、WikiPage、Account、AddressParser</li> <li>接口命名规则：
单个函数的接口名以&quot;er&quot;作为后缀，如Reader,Writer
接口的实现则去掉“er”</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Reader <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">Read</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>两个函数的接口名综合两个函数名<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> WriteFlusher <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
  <span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>
</code></pre></div><p>三个以上函数的接口名，类似于结构体名<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Car <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span>
  <span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
  <span class="token function">Recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="包"><a href="#包" aria-hidden="true" class="header-anchor">#</a> 包</h2> <ul><li>包名命名规则：包名应该为小写单词，不要使用下划线或者混合大小写。</li> <li>文件夹命名规则：小写单词，使用横杠连接</li> <li>文件命名 规则：小写单词，使用下划线连接，测试文件_test.go结束</li> <li>一般情况下包名和文件夹命名是一致的，不过也可以不一样</li></ul> <h2 id="常量"><a href="#常量" aria-hidden="true" class="header-anchor">#</a> 常量</h2> <p>常量均需使用全部大写字母组成，并使用下划线分词：<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">const</span> APP_VER <span class="token operator">=</span> <span class="token string">&quot;1.0&quot;</span>
</code></pre></div><p>如果是枚举类型的常量，需要先创建相应类型：<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Scheme <span class="token builtin">string</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
  HTTP  Scheme <span class="token operator">=</span> <span class="token string">&quot;http&quot;</span>
  HTTPS Scheme <span class="token operator">=</span> <span class="token string">&quot;https&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><h2 id="变量"><a href="#变量" aria-hidden="true" class="header-anchor">#</a> 变量</h2> <p>变量名称一般遵循驼峰法，但遇到特有名词时，需要遵循以下规则：<br></p> <ul><li>如果变量为私有，且特有名词为首个单词，则使用小写，如 apiClient</li> <li>其它情况都应当使用该名词原有的写法，如 APIClient、repoID、UserID</li> <li>错误示例：UrlArray，应该写成 urlArray 或者 URLArray</li></ul> <p>若变量类型为 bool 类型，则名称应以 Has, Is, Can 或 Allow 开头：<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> isExist boolvar hasConflict <span class="token builtin">bool</span>
<span class="token keyword">var</span> canManage <span class="token builtin">bool</span>
<span class="token keyword">var</span> allowGitHook <span class="token builtin">bool</span>
</code></pre></div><p>多个变量声明放在一起<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> <span class="token punctuation">(</span>
  isExist <span class="token builtin">bool</span>
  count <span class="token builtin">int</span>
<span class="token punctuation">)</span>
</code></pre></div><p>在函数外部声明使用var,不要采用:=</p> <h2 id="struct"><a href="#struct" aria-hidden="true" class="header-anchor">#</a> struct</h2> <p>声明和初始化采用多行，初始化结构体使用带有标签的语法<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span><span class="token punctuation">{</span>
  Username  <span class="token builtin">string</span>
  Email     <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-go extra-class"><pre class="language-go"><code>u <span class="token operator">:=</span> User<span class="token punctuation">{</span>
  Username<span class="token punctuation">:</span> <span class="token string">&quot;yourname&quot;</span><span class="token punctuation">,</span>
  Email<span class="token punctuation">:</span>    <span class="token string">&quot;yourname@gmail.com&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改对象属性不能直接使用赋值，要写成方法且必须加锁<br>
结构体中的私有变量用m_开头,导出变量直接大写字母开头<br></p> <h2 id="map"><a href="#map" aria-hidden="true" class="header-anchor">#</a> map</h2> <p>非线程安全，并发读写map的情况下必须加锁，不然会产生panic除非确定不会并发访问,要不然使用sync.Map</p> <h2 id="函数"><a href="#函数" aria-hidden="true" class="header-anchor">#</a> 函数</h2> <p>函数采用命名的多值返回，传入变量和返回变量以小写字母开头</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">nextInt</span><span class="token punctuation">(</span>b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> pos <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>value<span class="token punctuation">,</span> nextPos <span class="token builtin">int</span><span class="token punctuation">)</span>
</code></pre></div><p>函数返回值可能为空或零值时，最好加一个逻辑判断的返回值<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Foo</span><span class="token punctuation">(</span>a <span class="token builtin">int</span><span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">bool</span><span class="token punctuation">)</span>
</code></pre></div><p>函数返回用显式，不要用隐式，避免返回值被重复定义，导致返回值错误，特别是error返回值<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bar <span class="token operator">*</span>Bar<span class="token punctuation">,</span>err <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  a<span class="token punctuation">,</span>err<span class="token operator">:=</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span>  <span class="token boolean">nil</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
  <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre></div><p>约定下面的写法<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bar <span class="token operator">*</span>Bar<span class="token punctuation">,</span>err <span class="token builtin">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  a<span class="token punctuation">,</span>err<span class="token operator">:=</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span>  <span class="token boolean">nil</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span>err
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
  <span class="token keyword">return</span> bar<span class="token punctuation">,</span><span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="init"><a href="#init" aria-hidden="true" class="header-anchor">#</a> init</h2> <ul><li>在同一个文件中，可以重复定义init方法</li> <li>在同一个文件中，多个init方法按照在代码中编写的顺序依次执行</li> <li>在同一个package中，可以多个文件中定义init方法</li> <li>在同一个package中，不同文件中的init方法的执行按照文件名先后执行各个文件中的init方法</li></ul> <p>建议同一个文件中只定义一个init方法，同一个package中init尽量合并</p> <h2 id="错误处理"><a href="#错误处理" aria-hidden="true" class="header-anchor">#</a> 错误处理</h2> <ul><li>error作为函数的值返回,必须对error进行处理</li> <li>错误描述如果是英文必须为小写，不需要标点结尾</li> <li>采用独立的错误流进行处理</li></ul> <p>不要采用下面的处理错误写法:<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token comment">// error handling</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// normal code</span>
<span class="token punctuation">}</span>
</code></pre></div><p>采取下面的写法<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token comment">// error handling</span>
    <span class="token keyword">return</span> <span class="token comment">// or continue, etc.</span>
<span class="token punctuation">}</span>
<span class="token comment">// normal code</span>
</code></pre></div><p>使用函数返回值时，则采用下面的方式<br></p> <div class="language-go extra-class"><pre class="language-go"><code>x<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token comment">// error handling</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
<span class="token comment">// use x</span>
</code></pre></div><h2 id="控制结构"><a href="#控制结构" aria-hidden="true" class="header-anchor">#</a> 控制结构</h2> <p>if 接受初始化语句，约定如下方式建立局部变量<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">if</span> err <span class="token operator">:=</span> file<span class="token punctuation">.</span><span class="token function">Chmod</span><span class="token punctuation">(</span><span class="token number">0664</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> err
<span class="token punctuation">}</span>
</code></pre></div><p>for 采用短声明建立局部变量<br></p> <div class="language-go extra-class"><pre class="language-go"><code>sum <span class="token operator">:=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  sum <span class="token operator">+=</span> i
<span class="token punctuation">}</span>
</code></pre></div><p>range<br>
如果只需要第一项(key)，则丢弃第二个<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">for</span> key <span class="token operator">:=</span> <span class="token keyword">range</span> m <span class="token punctuation">{</span>
    <span class="token keyword">if</span> key<span class="token punctuation">.</span><span class="token function">expired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">delete</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果只需要第二项，则把第一项置为下划线<br></p> <div class="language-go extra-class"><pre class="language-go"><code>sum <span class="token operator">:=</span> <span class="token number">0</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> value <span class="token operator">:=</span> <span class="token keyword">range</span> array <span class="token punctuation">{</span>
    sum <span class="token operator">+=</span> value
<span class="token punctuation">}</span>
</code></pre></div><p>return 尽早 return；一旦有错误发生，马上返回<br></p> <div class="language-go extra-class"><pre class="language-go"><code>f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> err
<span class="token punctuation">}</span>

d<span class="token punctuation">,</span> err <span class="token operator">:=</span> f<span class="token punctuation">.</span><span class="token function">Stat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> err
<span class="token punctuation">}</span>
<span class="token function">codeUsing</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> d<span class="token punctuation">)</span>
</code></pre></div><h2 id="panic"><a href="#panic" aria-hidden="true" class="header-anchor">#</a> panic</h2> <p>在逻辑处理中不要使用panic，且业务逻辑中要有recover机制</p> <h2 id="import"><a href="#import" aria-hidden="true" class="header-anchor">#</a> import</h2> <p>对 import 的包进行分组管理，用换行符分割，而且标准库作为分组的第一组。如果你的包引入了三种类型的包，标准库包，程序内部包，第三方包，建议采用如下方式进行组织你的包。<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main
 
<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;os&quot;</span>

  <span class="token string">&quot;kmg/a&quot;</span>
  <span class="token string">&quot;kmg/b&quot;</span>

  <span class="token string">&quot;code.google.com/a&quot;</span>
  <span class="token string">&quot;github.com/b&quot;</span>
<span class="token punctuation">)</span>
</code></pre></div><p>在项目中不要使用相对路径引入包：<br>
// 错误示例<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;../net&quot;</span>
</code></pre></div><p>// 正确做法<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;github.com/repo/proj/src/net&quot;</span>
</code></pre></div><h2 id="参数传递"><a href="#参数传递" aria-hidden="true" class="header-anchor">#</a> 参数传递</h2> <ul><li>对于少量数据，不要传递指针</li> <li>对于大量数据的 struct 可以考虑使用指针</li> <li>传入的参数是 map，slice，chan 不要传递指针，因为 map，slice，chan 是引用类型，不需要传递指针的指针</li></ul> <h2 id="单元测试"><a href="#单元测试" aria-hidden="true" class="header-anchor">#</a> 单元测试</h2> <p>单元测试文件名命名规范：<br> <code>example_test.go</code><br>
测试用例的函数名称必须以 Test 开头，例如：<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestExample</span><span class="token punctuation">(</span>t <span class="token operator">*</span> testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span>
</code></pre></div><p>性能测试：<br>
函数名以Benchmark开头<br></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">BenchmarkExample</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span>
</code></pre></div><h2 id="日志"><a href="#日志" aria-hidden="true" class="header-anchor">#</a> 日志</h2> <ul><li>为了方便日志分析，记录日志统一使用glog或项目自己定义的log包</li> <li>记录有意义的日志，日志里记录一些比较有意义的状态数据：程序启动，退出的时间点；程序运行消耗时间；耗时程序的执行进度；重要变量的状态变化。</li> <li>日志内容必须是可读的英文语句，第一个单词首字母大写，合理标点符号</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>glog.V<span class="token punctuation">(</span>2<span class="token punctuation">)</span>.Infof<span class="token punctuation">(</span><span class="token string">&quot;Skipping nil field: %s&quot;</span>, key<span class="token punctuation">)</span>
glog.Errorf<span class="token punctuation">(</span><span class="token string">&quot;Failed to changes docker version to docker apiverson: %v&quot;</span>, err<span class="token punctuation">)</span>
glog.Fatalf<span class="token punctuation">(</span><span class="token string">&quot;Error compiling: %v&quot;</span>, err<span class="token punctuation">)</span>
</code></pre></div><ul><li>错误日志必须日志打印：<br></li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> serverFailureDetector<span class="token punctuation">.</span><span class="token function">Detect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   glog<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to detect server failure, %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
   <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>日志等级<br>
等级	方法	说明<br></li> <li>Fatal	glog.Fatal	致命的异常，造成服务中断的错误, 一般只在程序初始化校验阶段使用</li> <li>Error	glog.Error	异常，其他错误运行期错误；</li> <li>Warning	glog.Warning	警告，如程序调用了一个即将作废的接口，接口的不当使用，运行状态不是期望的但仍可继续处理等；</li> <li>Info	glog.Info	有意义的信息，如程序启动，关闭事件，收到请求事件等；</li> <li>Debug	glog.V(2).Info	调试信息，可记录详细的业务处理到哪一步了，以及当前的变量状态；</li> <li>Trace	glog.V(5).Info	更详细的跟踪信息；</li></ul> <h2 id="依赖包"><a href="#依赖包" aria-hidden="true" class="header-anchor">#</a> 依赖包</h2> <p>依赖包统一用govendor管理，详情参考依赖包管理<br>
本文档以以下文档为原型修改而成 <a href="rhttps://blog.csdn.net/wlhdo71920145/article/details/81092697">Golang编程规范</a></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/wubai-blog/assets/js/app.4c219921.js" defer></script><script src="/wubai-blog/assets/js/22.e7a0c376.js" defer></script>
  </body>
</html>
